<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HT32SX Application Notes: Monarch Scan Application for HT32SX</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="htlogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HT32SX Application Notes
   </div>
   <div id="projectbrief">Monarch Scan Application</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html','');});
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Monarch Scan Application for HT32SX </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div align="center"> <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSesenrhZDRBpVRdUHpQ5ouT6wUTu0t0zaYtSI5GZqXJjGc2tor4Q&amp;s" alt="" class="inline"/> </div><h2><a class="anchor" id="autotoc_md34"></a>
Introduction</h2>
<p>The iMCP is a Multicomponent Integrated Circuit (MCO) built for the Internet of Things, it provides a ready-to-use connectivity solution for the SigFox™ network. The system combines an ARM Cortex M0+ 32bit, a S2-LP high performance, ultra-low power RF transceiver and a RF Power Amplifier with all of the advantages, integration and convenience found in a SiP (System In Package), which is one of the most advanced semiconductor packaging technology. As a SigFox™ Monarch enabled device, it can operate in all regions covered by SigFox™ Network without need of reconfiguration. This is possible because the device can detect the region of operation and rearrange its setup automatically.</p>
<h2><a class="anchor" id="autotoc_md35"></a>
About this document</h2>
<p>The purpose of this document is to assist the engineer and explain how the SigFox™ protocol can be used on the iMCP – HT32SX. The firmware described in this document is version 4.19.50, it has integrated SigFox™ and SigFox™ Monarch driver support, which simplifies the usage of resources and the access to the SigFox™ network. The measurements and analysis included in this application note is based upon HT Micron’s interpretation of both measurements and rules. It is recommended to read this application note in conjunction with HT Micron User’s Guide. The whole application can be viwed clicking on the "Files" tab on the left hand.</p>
<p>In this application note, we explore the Monarch feature, which is able to recognize a Monarch Beacon in all of regions covered by SigFox™ network.</p>
<h2><a class="anchor" id="autotoc_md36"></a>
Application description</h2>
<p>The application starts configuring the MCU peripherals needed for the transceiver operation and the Universal Synchronous Asynchronous Receiver Transmitter (USART1), which is necessary to see and verify the results returned from all of functions used in this software. When everything is ready, the algorithm begins scanning a Monarch Beacon for a period of 10 minutes. If a Beacon is found, the device is going to reconfigure itself and will send a frame to the currently region. The payload to be sent, will load with it a message containing an integer corresponding to the region that was found. The user may check the message sent searching for the device ID at the SigFox™ Backend. More information about it can be found reading the Getting Started document.</p>
<p>The user may check the message sent searching for the device ID at the SigFox™ Backend. More information about it can be found reading the Getting Started document.</p>
<h2><a class="anchor" id="autotoc_md37"></a>
Software architecture</h2>
<p>The project was developed at Keil µVision IDE, fallowing the STM32CubeMX patterns. All of the SigFox Libraries are also included.</p>
<p>For organizational purpose, the project was divided by MCU peripherals. The user may see, for example, the RTC implementation looking at the “rtc.c” file. The same was made for GPIO, timers, SPI, and USART.</p>
<h3><a class="anchor" id="autotoc_md38"></a>
Code description</h3>
<div align="center"> <b>Table 1. Available Functions</b> </div><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Name  </th><th class="markdownTableHeadNone">Arguments  </th><th class="markdownTableHeadNone">Descripton   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>monarchScan</b>  </td><td class="markdownTableBodyNone"><b>rc_capabilities_bit_mask:</b> Bit Mask (Table 2) of the RCx on which the scan has to be executed.<br  />
 <b>timer:</b> Scan duration value (with the unit parameter information). <br  />
 <b>unit:</b> Unit to be considered for the scan time computation  </td><td class="markdownTableBodyNone">This function executes a scan of the air to detect a SigFox Beacon. It will return 0, if success and the RC enum value corresponding to the beacon found and its RSSI level. The scan is executed during the specific timer/unit time.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>configRegion</b>  </td><td class="markdownTableBodyNone">None  </td><td class="markdownTableBodyNone">Configures the device using the RCZ found after Monarch Scan. Call the functions St_Sigfox_Open_RCZ, to execute these configurations and sendFrameRCZ. Both functions will be described below.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>St_Sigfox_Open_RCZ</b>  </td><td class="markdownTableBodyNone">RCZ: Integer corresponding to the radio zone.  </td><td class="markdownTableBodyNone">Opens SigFox Library according to the zone. Returns 0 if ok.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>sendFrameRCZ</b>  </td><td class="markdownTableBodyNone">None  </td><td class="markdownTableBodyNone">Send a frame to the SigFox network using the RCZ found after Monarch Scan. Returns 0 if success.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>closeSigfoxLib</b>  </td><td class="markdownTableBodyNone">None  </td><td class="markdownTableBodyNone">This function closes the library (Free the allocated memory of SIGFOX_API_open and close RF). Returns 0 if success.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>mcuConfig</b>  </td><td class="markdownTableBodyNone">None  </td><td class="markdownTableBodyNone">Starts the MCU peripherals configuration and get credentials from Flash memory.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>ST_Init</b>  </td><td class="markdownTableBodyNone">None  </td><td class="markdownTableBodyNone">Configure the MCU peripherals needed for the transceiver operation.   </td></tr>
</table>
<p><br  />
</p>
<div align="center"> <b>Table 2. SigFox Monarch RC Capabilities bitmask.</b> </div><div align="center"> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Bit7  </th><th class="markdownTableHeadCenter">Bit6  </th><th class="markdownTableHeadCenter">Bit5  </th><th class="markdownTableHeadCenter">Bit4  </th><th class="markdownTableHeadCenter">Bit3  </th><th class="markdownTableHeadCenter">Bit2  </th><th class="markdownTableHeadCenter">Bit1  </th><th class="markdownTableHeadRight">Bit0   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">-  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">RC6  </td><td class="markdownTableBodyCenter">RC5  </td><td class="markdownTableBodyCenter">RC4  </td><td class="markdownTableBodyCenter">RC3  </td><td class="markdownTableBodyCenter">RC2  </td><td class="markdownTableBodyRight">RC1   </td></tr>
</table>
</div><p><br  />
</p>
<h2><a class="anchor" id="autotoc_md39"></a>
Results</h2>
<p>Some results are expected running this application. First, the monarch scan begins, looking for a Monarch Beacon. This process will still go on for 10 minutes, showing the rssi and printing on the RS232 terminal the region which was found. At the end, a frame is sent to the currently region. The results can be seen below:</p>
<div align="center"> <img src="https://www.googleapis.com/drive/v3/files/1Zk3hGocssoDgSSVlAkGDNPV6K7wrB6Dk?alt=media&amp;key=AIzaSyCm-djN9v8CYvbkJ1YNUGdKxo0DrotYn74" alt="" class="inline"/> </div><div align="center"> <img src="https://www.googleapis.com/drive/v3/files/1ixfsPEG8xkcZ4hOcd0WZYsEAXSc6SSlp?alt=media&amp;key=AIzaSyCm-djN9v8CYvbkJ1YNUGdKxo0DrotYn74" alt="" class="inline"/> </div><h2><a class="anchor" id="autotoc_md40"></a>
Extra Documentation</h2>
<p>Datasheets and application notes can be found at the <a href="https://github.com/htmicron/ht32sx"><b>HT32SX Repository</b></a>.</p>
<h2><a class="anchor" id="autotoc_md41"></a>
References</h2>
<p>For additional information about SigFox™ libraries designed by ST Microelectronics, please refer to the UM2173 document (note: the function names still the same, but the code was adapted to use in the iMCP design, so it is different from the one distributed by ST).</p>
<h2><a class="anchor" id="autotoc_md42"></a>
Contact Information</h2>
<p>Head Office – São Leopoldo, RS HT Micron Semiconductors Unisinos Avenue, 1550 São Leopoldo - RS <br  />
 ZIP 93022-750 <br  />
 Brazil <br  />
 Tel: +55 51 3081-8650 <br  />
 E-mail (Support): <a href="#" onclick="location.href='mai'+'lto:'+'sup'+'po'+'rt_'+'io'+'t@h'+'tm'+'icr'+'on'+'.co'+'m.'+'br'; return false;">suppo<span style="display: none;">.nosp@m.</span>rt_i<span style="display: none;">.nosp@m.</span>ot@ht<span style="display: none;">.nosp@m.</span>micr<span style="display: none;">.nosp@m.</span>on.co<span style="display: none;">.nosp@m.</span>m.br</a> <br  />
 E-mail (General Enquiries): <a href="#" onclick="location.href='mai'+'lto:'+'htm'+'ic'+'ron'+'@h'+'tmi'+'cr'+'on.'+'co'+'m.b'+'r'; return false;">htmic<span style="display: none;">.nosp@m.</span>ron@<span style="display: none;">.nosp@m.</span>htmic<span style="display: none;">.nosp@m.</span>ron.<span style="display: none;">.nosp@m.</span>com.b<span style="display: none;">.nosp@m.</span>r</a> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
